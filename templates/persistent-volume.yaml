apiVersion: v1
kind: PersistentVolume
metadata:
  name: data-persistent-volume
  namespace: {{ include "palisade.namespace" . }}
  labels:
    for-app: {{ include "palisade.namespace" . }}
spec:
  persistentVolumeReclaimPolicy: Retain
  capacity:
    storage: 5Gi
  accessModes:
  - ReadOnlyMany
  {{- if eq .Values.hosting "local" }}
  storageClassName: hostpath-data-storage
  hostPath:
    path: {{ .Values.storage.dataPath }}
    type: DirectoryOrCreate
  {{- else if eq .Values.hosting "cloud" }}
  {{- if eq .Values.cloudProvider "aws" }}
  storageClassName: efs-data-storage
  csi:
    driver: efs.csi.aws.com
    volumeHandle: {{ .Values.storage.efsVolumeHandle  }}
    volumeAttributes:
      path: {{ .Values.storage.dataPath }}
  {{- end }}
  {{- else if eq .Values.hosting "metal" }}
  # TODO: what to do for storage on bare-metal deployment
  {{- end }}
